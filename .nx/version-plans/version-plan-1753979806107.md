---
app-sdk: major
---

## JWT Refactor

#### Refactored our JWT structure, composition, and verification logic.

- Removed dependency on `did-jwt`; since we are signing using EIP-191 compliant signatures, the presence of `did:ethr` was misleading.
- Added support for Delegatee JWTs

#### We now support 3 types of JWT:

- `VincentJWTAppUser`
  - `role` claim in the JWT payload is `app-user`
  - Contains PKP info
  - Is app-specific
  - Is provided to app end-users, so that they can authenticate with services that are provided by individual Vincent Apps
- `VincentJWTPlatformUser`
  - `role` claim in the JWT payload is `platform-user`
  - Contains PKP info
  - Used to authenticate with Vincent platform services (e.g. the registry backend)
  - Is not app-specific
  - The Vincent dashboard uses these for App owners and Ability & Policy authors
- `VincentJWTDelegatee`
  - `role` claim in the JWT payload is `app-delegatee`
  - Does not contain PKP info; delegatees are not PKP-backed
  - Is not app-specific
  - Used to authenticate with services that require proof that they are being used by a specific delegatee who has permissions to act on behalf of a delegator (app user) account.

### API Changes

- Many classes and interfaces were renamed to clearly indicate which type of JWT that they apply to.
- Added `publicKey` to the `payload` of all JWTs for signature verification convenience
- `iss` and `sub` are now raw hex-formatted ethers addresses, without `did:ethr` prefixes
- JWT verification has been converted to be an async process, and explicit verify methods have been defined for each type of JWT
  - `verifyVincentAppUserJWT()`
  - `verifyVincentPlatformJWT()`
  - `verifyVincentDelegateeJWT()`
- Type-guard functions have also been added to help identify the kind of JWT you are using and provide type-safe references to those JWTs, but for most use-cases you will probably just use the type-specific `verify` methods.
  - `isVincentJWTAppSpecific()`
  - `isVincentPlatformJWT()`
  - `isVincentJWTDelegatee()`
  - `isAnyVincentJWT()`
- Added accessor helper functions to facilitate easy, type-safe access to properties on supported JWTs
  - `getRole()` - All Vincent JWTs
  - `getPublicKey()` - All Vincent JWTs
  - `getIssuerAddress()` - All Vincent JWTs
  - `getAudience()` - All Vincent JWTs
  - `getSubjectAddress()` - Only for `VincentJWTDelegatee`
  - `getAppInfo()` - Only for `VincentJWTAppUser`
  - `getPKPInfo()` - Only for `VincentJWTAppUser` or `VincentJWTPlatformUser`
  - `getAuthentication()` - Only for `VincentJWTAppUser` or `VincentJWTPlatformUser`
- `decode` has been renamed to `decodeVincentJWT()`;
  - You probably want to use the type-specific `verify` methods instead of calling decode directly, unless you're absolutely sure that you've already verified the JWT and are positive it hasn't expired!
  - This function returns an `AnyVincentJWT` type which you must narrow using type-guard functions.
