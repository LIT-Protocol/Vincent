---
title: 'Request Withdraw'
api: 'POST /user/{appId}/request-withdraw'
---

After checking available balances with [agent-funds](/wallet-providers/agent-funds), use this endpoint to initiate a withdrawal of tokens from the user's agent smart account back to their controller wallet. This endpoint prepares unsigned UserOperations that the user must sign to authorize the withdrawal.

<Note>
This is the first step in a two-step withdrawal process. After receiving the unsigned UserOperations, the user must sign them and submit to [complete-withdraw](/wallet-providers/complete-withdraw) to execute the transfers.
</Note>

## Request

<ParamField path="appId" type="integer" required>
  The unique identifier of the app
</ParamField>

<ParamField body="userControllerAddress" type="string" required>
  The Ethereum address of the user's wallet (recipient of withdrawn funds)
</ParamField>

<ParamField body="assets" type="array" required>
  List of assets to withdraw from the agent account

  <Expandable title="Asset object properties">
    <ParamField body="network" type="string" required>
      Network identifier (e.g., `base-mainnet`, `base-sepolia`)
    </ParamField>
    <ParamField body="tokenAddress" type="string" required>
      Token contract address. Use `0x0000000000000000000000000000000000000000` for native tokens (ETH).
    </ParamField>
    <ParamField body="amount" type="number" required>
      Amount to withdraw in human-readable units (e.g., `10.5` for 10.5 USDC)
    </ParamField>
  </Expandable>
</ParamField>

## Response

<ResponseField name="withdrawals" type="array">
  List of unsigned UserOperations, one per network

  <Expandable title="Withdrawal object properties">
    <ResponseField name="network" type="string">
      Network identifier for this UserOperation
    </ResponseField>
    <ResponseField name="userOp" type="object">
      ERC-4337 UserOperation. Pass this back unchanged to complete-withdraw.

      <Expandable title="UserOperation fields">
        <ResponseField name="sender" type="string">
          The agent smart account address
        </ResponseField>
        <ResponseField name="nonce" type="string">
          Account nonce (hex)
        </ResponseField>
        <ResponseField name="callData" type="string">
          Encoded transfer call(s) (hex)
        </ResponseField>
        <ResponseField name="callGasLimit" type="string">
          Gas limit for execution (hex)
        </ResponseField>
        <ResponseField name="verificationGasLimit" type="string">
          Gas limit for verification (hex)
        </ResponseField>
        <ResponseField name="preVerificationGas" type="string">
          Gas for pre-verification (hex)
        </ResponseField>
        <ResponseField name="maxFeePerGas" type="string">
          Maximum fee per gas (hex)
        </ResponseField>
        <ResponseField name="maxPriorityFeePerGas" type="string">
          Maximum priority fee per gas (hex)
        </ResponseField>
        <ResponseField name="paymaster" type="string">
          Paymaster address (present if gas is sponsored)
        </ResponseField>
        <ResponseField name="paymasterData" type="string">
          Paymaster-specific data (hex)
        </ResponseField>
      </Expandable>
    </ResponseField>
    <ResponseField name="userOpHash" type="string">
      The hash to sign. Sign this with your wallet using `signMessage`.
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="errors" type="array">
  List of errors for networks that failed to prepare (only present if some networks failed)

  <Expandable title="Error object properties">
    <ResponseField name="network" type="string">
      Network identifier where the error occurred
    </ResponseField>
    <ResponseField name="error" type="string">
      Error message describing what went wrong
    </ResponseField>
  </Expandable>
</ResponseField>

<RequestExample>
```bash cURL
curl -X POST https://api.heyvincent.ai/user/123/request-withdraw \
  -H "Content-Type: application/json" \
  -d '{
    "userControllerAddress": "0xUserWalletAddress...",
    "assets": [
      {
        "network": "base-mainnet",
        "tokenAddress": "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",
        "amount": 100
      }
    ]
  }'
```

```typescript viem
import { createWalletClient, custom } from 'viem';

const response = await fetch(`https://api.heyvincent.ai/user/${appId}/request-withdraw`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    userControllerAddress: walletClient.account.address,
    assets: [
      {
        network: 'base-mainnet',
        tokenAddress: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913', // USDC on Base
        amount: 100
      }
    ]
  })
});

const { withdrawals } = await response.json();

// Sign each UserOperation using the provided hash
const signedWithdrawals = await Promise.all(
  withdrawals.map(async (withdrawal) => {
    // Sign the userOpHash directly - no hash computation needed
    const signature = await walletClient.signMessage({
      message: { raw: withdrawal.userOpHash as `0x${string}` }
    });
    return {
      network: withdrawal.network,
      userOp: withdrawal.userOp,
      signature
    };
  })
);

// Submit to complete-withdraw endpoint
```

```typescript ethers.js (v6)
import { getBytes } from 'ethers';

const response = await fetch(`https://api.heyvincent.ai/user/${appId}/request-withdraw`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    userControllerAddress: await signer.getAddress(),
    assets: [
      {
        network: 'base-mainnet',
        tokenAddress: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913', // USDC on Base
        amount: 100
      }
    ]
  })
});

const { withdrawals } = await response.json();

// Sign each UserOperation using the provided hash
const signedWithdrawals = await Promise.all(
  withdrawals.map(async (withdrawal) => {
    // Sign the raw hash bytes
    const signature = await signer.signMessage(
      getBytes(withdrawal.userOpHash)
    );
    return {
      network: withdrawal.network,
      userOp: withdrawal.userOp,
      signature
    };
  })
);

// Submit to complete-withdraw endpoint
```
</RequestExample>

<ResponseExample>
```json Response
{
  "withdrawals": [
    {
      "network": "base-mainnet",
      "userOp": {
        "sender": "0xAgentSmartAccountAddress...",
        "nonce": "0x1",
        "callData": "0xa9059cbb...",
        "callGasLimit": "0x5208",
        "verificationGasLimit": "0x10000",
        "preVerificationGas": "0x5208",
        "maxFeePerGas": "0x3b9aca00",
        "maxPriorityFeePerGas": "0x3b9aca00",
        "paymaster": "0xPaymasterAddress...",
        "paymasterData": "0x..."
      },
      "userOpHash": "0x1234567890abcdef..."
    }
  ]
}
```

```json Partial Failure
{
  "withdrawals": [
    {
      "network": "base-mainnet",
      "userOp": { ... },
      "userOpHash": "0x1234567890abcdef..."
    }
  ],
  "errors": [
    {
      "network": "ethereum",
      "error": "Insufficient balance for USDC: requested 100, available 50"
    }
  ]
}
```
</ResponseExample>
