---
title: Spot Buy
---

The `spotBuy` action enables Vincent Apps to execute buy orders on Hyperliquid's spot market using a Vincent User's HyperCore spot balance.

## Prerequisites

Before executing the `spotBuy` action, the following conditions must be met:

- **Spot Balance on HyperCore**: The Vincent User Agent Wallet must have sufficient balance for the quote asset in their HyperCore spot balance to cover the purchase amount. The quote asset is the second asset in the trading pair (e.g., USDC in "PURR/USDC").
- **Order Parameters**: You must provide a valid trading pair symbol (e.g., "PURR/USDC"), price, and size according to Hyperliquid's trading rules.

<Info>
  To learn more about executing Vincent Abilities, see the [Executing
  Abilities](/ability/explaining-abilities) guide.
</Info>

## Executing the `precheck` Function

The `precheck` function validates some prerequisites for executing a spot buy, without actually performing the operation.

For the `spotBuy` action, the `precheck` function will validate the following:

- The trading pair symbol is a valid Hyperliquid trading pair (e.g., "PURR/USDC").
- The Vincent User Agent Wallet has sufficient balance for the quote asset in their HyperCore spot balance to cover the purchase amount. The quote asset is the second asset in the trading pair (e.g. USDC in "PURR/USDC").

<Tabs>
  <Tab title="Parameters">
    The `precheck` function requires the following parameters:

    ```typescript
    import { HyperliquidAction } from '@lit-protocol/vincent-ability-hyperliquid';

    {
      /**
       * The action to perform (must be HyperliquidAction.SPOT_BUY)
       */
      action: HyperliquidAction.SPOT_BUY;
      /**
       * Whether to use Hyperliquid testnet (optional, defaults to false)
       */
      useTestnet?: boolean;
      /**
       * Spot buy parameters
       */
      spot: {
        /**
         * The trading pair symbol (e.g., "PURR/USDC", "ETH/USDC")
         */
        symbol: string;
        /**
         * The limit price for the buy order.
         * Must follow Hyperliquid's spot price rules:
         * - Max 5 significant figures
         * - Max (8 - szDecimals) decimal places
         * https://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api/tick-and-lot-size#spot-price-examples
         */
        price: string;
        /**
         * The size (amount of tokens) to buy.
         * Must be rounded to the token's szDecimals.
         * https://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api/tick-and-lot-size#spot-price-examples
         */
        size: string;
      };
    }
    ```

  </Tab>

  <Tab title="Implementation">
    To execute `precheck`, you'll need to:

    - Create an instance of the `VincentAbilityClient` using the `getVincentAbilityClient` function (imported from `@lit-protocol/vincent-app-sdk/abilityClient`)
      - Pass in the Ability's `bundledVincentAbility` object (imported from `@lit-protocol/vincent-ability-hyperliquid`)
      - Pass in the `ethersSigner` you'll be using to sign the request to Lit with your Delegatee private key
    - Use the `VincentAbilityClient` instance to call the `precheck` function

    ```typescript
    import { getVincentAbilityClient } from '@lit-protocol/vincent-app-sdk/abilityClient';
    import { bundledVincentAbility, HyperliquidAction } from '@lit-protocol/vincent-ability-hyperliquid';
    import { ethers } from 'ethers';

    // Your delegatee signer (one of the delegatee signers for the Vincent App)
    const delegateeSigner = new ethers.Wallet('YOUR_DELEGATEE_PRIVATE_KEY', provider);

    // Create ability client
    const hyperliquidAbilityClient = getVincentAbilityClient({
      bundledVincentAbility,
      ethersSigner: delegateeSigner,
    });

    // Run precheck
    const precheckResult = await hyperliquidAbilityClient.precheck(
      {
        action: HyperliquidAction.SPOT_BUY,
        useTestnet: false, // Set to true for testnet
        spot: {
          symbol: 'PURR/USDC',
          price: '5.1',
          size: '4',
        },
      },
      {
        delegatorPkpEthAddress: '0x...', // The Vincent User's Vincent Wallet address
      },
    );

    if (precheckResult.success) {
      console.log('Spot buy precheck passed, ready to execute');
    } else {
      // Handle different types of failures
      if (precheckResult.runtimeError) {
        console.error('Runtime error:', precheckResult.runtimeError);
      }
      if (precheckResult.schemaValidationError) {
        console.error('Schema validation error:', precheckResult.schemaValidationError);
      }
      if (precheckResult.result) {
        console.error('Spot buy precheck failed:', precheckResult.result.reason);
      }
    }
    ```

  </Tab>

  <Tab title="Response">
    ### Success

    A successful `precheck` response will contain:

    ```typescript
    {
      /**
       * The action that was prechecked
       */
      action: 'spotBuy';
    }
    ```

    ### Failure

    A failure `precheck` response will contain:

    ```typescript
    {
      /**
       * The action that was prechecked
       */
      action: 'spotBuy';
      /**
       * The reason the precheck failed, such as insufficient spot balance
       */
      reason: string;
    }
    ```

  </Tab>
</Tabs>

## Executing the `execute` Function

The `execute` function performs the actual buy operation, placing a buy order on Hyperliquid's spot market.

For the `spotBuy` action, the `execute` function will:

- Place a buy order for the specified token pair at the given price and size.
- Return the order result from Hyperliquid.

<Tabs>
  <Tab title="Parameters">
    The `execute` function requires the following parameters:

    ```typescript
    import { HyperliquidAction, OrderType } from '@lit-protocol/vincent-ability-hyperliquid';

    {
      /**
       * The action to perform (must be HyperliquidAction.SPOT_BUY)
       */
      action: HyperliquidAction.SPOT_BUY;
      /**
       * Whether to use Hyperliquid testnet (optional, defaults to false)
       */
      useTestnet?: boolean;
      /**
       * Spot buy parameters
       */
      spot: {
        /**
         * The trading pair symbol (e.g., "PURR/USDC", "ETH/USDC")
         */
        symbol: string;
        /**
         * The limit price for the buy order.
         * Must follow Hyperliquid's spot price rules:
         * - Max 5 significant figures
         * - Max (8 - szDecimals) decimal places
         * https://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api/tick-and-lot-size#spot-price-examples
         */
        price: string;
        /**
         * The size (amount of tokens) to buy.
         * Must be rounded to the token's szDecimals.
         * https://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api/tick-and-lot-size#spot-price-examples
         */
        size: string;
        /**
         * The order type for the buy order (optional).
         * You may specify either a limit or market order using the form:
         *   { type: "limit", tif: "Gtc" | "Ioc" | "Alo" }
         *   or
         *   { type: "market" }
         * Defaults to: { type: "limit", tif: "Gtc" }
         */
        orderType?:
          | { type: OrderType.LIMIT; tif: 'Gtc' | 'Ioc' | 'Alo' }
          | { type: OrderType.MARKET };
      };
    }
    ```

  </Tab>

  <Tab title="Implementation">
    The `execute` function can be executed using the same `VincentAbilityClient` instance as used for the `precheck` function:

    ```typescript
    import { OrderType } from '@lit-protocol/vincent-ability-hyperliquid';

    const executeResult = await hyperliquidAbilityClient.execute(
      {
        action: HyperliquidAction.SPOT_BUY,
        useTestnet: false, // Set to true for testnet
        spot: {
          symbol: 'PURR/USDC',
          price: '5.1',
          size: '4',
          orderType: { type: OrderType.MARKET }, // Optional: defaults to limit order with Gtc tif
        },
      },
      {
        delegatorPkpEthAddress: '0x...', // The Vincent User's Vincent Wallet address
      },
    );

    if (executeResult.success) {
      const { orderResult } = executeResult.result;
      console.log('Spot buy executed successfully:', orderResult);
    } else {
      // Handle different types of failures
      if (executeResult.runtimeError) {
        console.error('Runtime error:', executeResult.runtimeError);
      }
      if (executeResult.schemaValidationError) {
        console.error('Schema validation error:', executeResult.schemaValidationError);
      }
      if (executeResult.result) {
        console.error('Spot buy execution failed:', executeResult.result.reason);
      }
    }
    ```

  </Tab>

  <Tab title="Response">
    **Success Response**

    A successful `execute` response will contain:

    ```typescript
    {
      /**
       * The action that was executed
       */
      action: 'spotBuy';
      /**
       * The order response from Hyperliquid request as defined by the Hyperliquid SDK: @nktkas/hyperliquid
       * https://github.com/nktkas/hyperliquid/blob/2233ce942eb50ef8850073b387b9918d3a54a10b/src/api/exchange/order.ts#L103-L194
       */
      orderResult: OrderResponse;
    }
    ```

    **Failure Response**

    A failure `execute` response will contain:

    ```typescript
    {
      /**
       * The action that was executed
       */
      action: 'spotBuy';
      /**
       * The reason the execution failed, such as insufficient spot balance
       */
      reason: string;
    }
    ```

  </Tab>
</Tabs>

## Important Considerations

<AccordionGroup>
  <Accordion title="Price and Size Formatting Rules" icon="ruler">
    Hyperliquid has strict formatting requirements for spot orders. See the [Hyperliquid API documentation](https://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api/tick-and-lot-size#spot-price-examples) for more details.

  </Accordion>

<Accordion title="Getting Current Market Prices" icon="chart-line">
  You'll need to fetch the current market price before placing an order. Use the Hyperliquid API or
  SDK to get the mid price for your trading pair, then adjust it based on your strategy (e.g. 1%
  above mid price for market buys).
</Accordion>

<Accordion title="Order Types" icon="list">
  You can specify either a limit or market order using the `orderType` parameter. See the
  [Parameters](#parameters) section for more details.
</Accordion>

  <Accordion title="Verifying Order Success" icon="check">
    After the order is executed, you can verify the balances changed by checking the spot balances using a [Hyperliquid SDK](https://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api), or by using the [Hyperliquid API](https://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api/info-endpoint/spot#retrieve-a-users-token-balances).
  </Accordion>
</AccordionGroup>

## Reference Implementation

For a complete working example showing the full spot buy workflow including balance verification and price calculation, see the [buy.spec.ts](https://github.com/LIT-Protocol/Vincent/blob/main/packages/apps/ability-hyperliquid/test/e2e/spot/buy.spec.ts) end-to-end test in the `ability-hyperliquid` package.

## Next Steps

Explore the rest of the supported Hyperliquid actions:

<CardGroup cols={3}>

<Card title="Deposit" href="/ability/official-abilities/hyperliquid/deposit" icon="arrow-down" />

<Card title="Withdraw" href="/ability/official-abilities/hyperliquid/withdraw" icon="arrow-up" />

<Card
  title="Send Spot Asset"
  href="/ability/official-abilities/hyperliquid/spot-trading/send-asset"
  icon="coins"
/>

<Card
  title="Send Perp USDC"
  href="/ability/official-abilities/hyperliquid/perp-trading/send-usdc"
  icon="dollar-sign"
/>

<Card
  title="Transfer to Spot"
  href="/ability/official-abilities/hyperliquid/transfer-to-spot"
  icon="arrow-right"
/>

<Card
  title="Transfer to Perp"
  href="/ability/official-abilities/hyperliquid/transfer-to-perp"
  icon="arrow-left"
/>

<Card title="Spot Sell" href="/ability/official-abilities/hyperliquid/spot-trading/sell" icon="tag" />

<Card
  title="Perp Long"
  href="/ability/official-abilities/hyperliquid/perp-trading/long"
  icon="arrow-up-right"
/>

<Card
  title="Perp Short"
  href="/ability/official-abilities/hyperliquid/perp-trading/short"
  icon="arrow-down-right"
/>

<Card title="Cancel Order" href="/ability/official-abilities/hyperliquid/cancel-order" icon="ban" />

<Card
  title="Cancel All Orders"
  href="/ability/official-abilities/hyperliquid/cancel-all-orders-for-symbol"
  icon="trash"
/>

</CardGroup>
