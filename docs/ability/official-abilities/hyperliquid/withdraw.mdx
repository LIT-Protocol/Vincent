---
title: Withdraw
---

The `withdraw` action enables Vincent Apps to bridge USDC from a Vincent User's HyperCore perp balance back to Arbitrum using the Hyperliquid bridge.

## Prerequisites

Before executing the `withdraw` action, the following conditions must be met:

- **Perp Balance on HyperCore**: The Vincent User Agent Wallet must have sufficient USDC in their HyperCore perp balance to cover the withdrawal amount.
- **Destination Address** (optional): You can specify a destination address on Arbitrum. If not provided, the withdrawal will be sent to the Vincent User's Agent Wallet address on Arbitrum.

<Info>
  To learn more about executing Vincent Abilities, see the [Executing
  Abilities](/ability/explaining-abilities) guide.
</Info>

## Executing the `precheck` Function

The `precheck` function validates some prerequisites for executing a withdrawal, without actually performing the operation.

For the `withdraw` action, the `precheck` function will validate the following:

- The Vincent User Agent Wallet has a HyperCore perp account.
- The withdrawal amount is at least $1 USDC (due to the withdrawal fee required by Hyperliquid).
- The Vincent User Agent Wallet has sufficient USDC in their HyperCore perp balance to cover the withdrawal amount.

<Tabs>
  <Tab title="Parameters">
    The `precheck` function requires the following parameters:

    ```typescript
    import { HyperliquidAction } from '@lit-protocol/vincent-ability-hyperliquid';

    {
      /**
       * The action to perform (must be HyperliquidAction.WITHDRAW)
       */
      action: HyperliquidAction.WITHDRAW;
      /**
       * Whether to use Hyperliquid testnet (optional, defaults to false)
       */
      useTestnet?: boolean;
      /**
       * Withdraw parameters
       */
      withdraw: {
        /**
         * The amount of USDC to withdraw in 6-decimal format.
         * Example: "5000000" = 5 USDC
         */
        amount: string;
        /**
         * The destination address on Arbitrum (optional).
         * If not provided, defaults to the Vincent User's Agent Wallet address.
         */
        destination?: string;
      };
    }
    ```

  </Tab>

  <Tab title="Implementation">
    To execute `precheck`, you'll need to:

    - Create an instance of the `VincentAbilityClient` using the `getVincentAbilityClient` function (imported from `@lit-protocol/vincent-app-sdk/abilityClient`)
      - Pass in the Ability's `bundledVincentAbility` object (imported from `@lit-protocol/vincent-ability-hyperliquid`)
      - Pass in the `ethersSigner` you'll be using to sign the request to Lit with your Delegatee private key
    - Use the `VincentAbilityClient` instance to call the `precheck` function

    ```typescript
    import { getVincentAbilityClient } from '@lit-protocol/vincent-app-sdk/abilityClient';
    import { bundledVincentAbility, HyperliquidAction } from '@lit-protocol/vincent-ability-hyperliquid';
    import { ethers } from 'ethers';

    // Your delegatee signer (one of the delegatee signers for the Vincent App)
    const delegateeSigner = new ethers.Wallet('YOUR_DELEGATEE_PRIVATE_KEY', provider);

    // Create ability client
    const hyperliquidAbilityClient = getVincentAbilityClient({
      bundledVincentAbility,
      ethersSigner: delegateeSigner,
    });

    // Run precheck
    const precheckResult = await hyperliquidAbilityClient.precheck(
      {
        action: HyperliquidAction.WITHDRAW,
        useTestnet: false, // Set to true for testnet
        withdraw: {
          amount: '5000000', // 5 USDC in 6-decimal format
          // destination is optional, defaults to Vincent User's Agent Wallet address
        },
      },
      {
        delegatorPkpEthAddress: '0x...', // The Vincent User's Vincent Wallet address
      },
    );

    if (precheckResult.success) {
      console.log('Withdraw precheck passed, ready to execute');
    } else {
      // Handle different types of failures
      if (precheckResult.runtimeError) {
        console.error('Runtime error:', precheckResult.runtimeError);
      }
      if (precheckResult.schemaValidationError) {
        console.error('Schema validation error:', precheckResult.schemaValidationError);
      }
      if (precheckResult.result) {
        console.error('Withdraw precheck failed:', precheckResult.result.reason);
      }
    }
    ```

  </Tab>

  <Tab title="Response">
    ### Success

    A successful `precheck` response will contain:

    ```typescript
    {
      /**
       * The action that was prechecked
       */
      action: 'withdraw';
    }
    ```

    ### Failure

    A failure `precheck` response will contain:

    ```typescript
    {
      /**
       * The action that was prechecked
       */
      action: 'withdraw';
      /**
       * The reason the precheck failed, such as insufficient perp balance
       */
      reason: string;
      /**
       * The available USDC balance in the Vincent User's HyperCore perp account (optional)
       */
      availableBalance?: string;
      /**
       * The required USDC balance in the Vincent User's HyperCore perp account to cover the withdrawal amount and withdrawal fee (optional)
       */
      requiredBalance?: string;
    }
    ```

  </Tab>
</Tabs>

## Executing the `execute` Function

The `execute` function performs the actual withdrawal by initiating a bridge transfer from the Vincent User's HyperCore perp balance to Arbitrum.

For the `withdraw` action, the `execute` function will:

- Initiate a withdrawal of the specified amount of USDC from the Vincent User Agent Wallet's HyperCore perp balance to the specified destination address on Arbitrum (or the Agent Wallet address if no destination is provided).
- Return the withdrawal result from Hyperliquid.

<Tabs>
  <Tab title="Parameters">
    The `execute` function requires the following parameters:

    ```typescript
    import { HyperliquidAction } from '@lit-protocol/vincent-ability-hyperliquid';

    {
      /**
       * The action to perform (must be HyperliquidAction.WITHDRAW)
       */
      action: HyperliquidAction.WITHDRAW;
      /**
       * Whether to use Hyperliquid testnet (optional, defaults to false)
       */
      useTestnet?: boolean;
      /**
       * Withdraw parameters
       */
      withdraw: {
        /**
         * The amount of USDC to withdraw in 6-decimal format.
         * Example: "5000000" = 5 USDC
         */
        amount: string;
        /**
         * The destination address on Arbitrum (optional).
         * If not provided, defaults to the Vincent User's Agent Wallet address.
         */
        destination?: string;
      };
    }
    ```

  </Tab>

  <Tab title="Implementation">
    The `execute` function can be executed using the same `VincentAbilityClient` instance as used for the `precheck` function:

    ```typescript
    const executeResult = await hyperliquidAbilityClient.execute(
      {
        action: HyperliquidAction.WITHDRAW,
        useTestnet: false, // Set to true for testnet
        withdraw: {
          amount: '5000000', // 5 USDC in 6-decimal format
          destination: '0x...', // Optional: specify destination address on Arbitrum
        },
      },
      {
        delegatorPkpEthAddress: '0x...', // The Vincent User's Vincent Wallet address
      },
    );

    if (executeResult.success) {
      const { withdrawResult } = executeResult.result;
      console.log('Withdrawal initiated:', withdrawResult);
    } else {
      // Handle different types of failures
      if (executeResult.runtimeError) {
        console.error('Runtime error:', executeResult.runtimeError);
      }
      if (executeResult.schemaValidationError) {
        console.error('Schema validation error:', executeResult.schemaValidationError);
      }
      if (executeResult.result) {
        console.error('Withdraw execution failed:', executeResult.result.reason);
      }
    }
    ```

  </Tab>

  <Tab title="Response">
    **Success Response**

    A successful `execute` response will contain:

    ```typescript
    {
      /**
       * The action that was executed
       */
      action: 'withdraw';
      /**
       * The withdrawal result from Hyperliquid request as defined by the Hyperliquid SDK: @nktkas/hyperliquid
       * https://github.com/nktkas/hyperliquid/blob/2233ce942eb50ef8850073b387b9918d3a54a10b/src/api/exchange/_base/_schemas.ts#L49-L73
       */
      withdrawResult: SuccessResponse;
    }
    ```

    **Failure Response**

    A failure `execute` response will contain:

    ```typescript
    {
      /**
       * The action that was executed
       */
      action: 'withdraw';
      /**
       * The reason the execution failed, such as insufficient perp balance
       */
      reason: string;
    }
    ```

  </Tab>
</Tabs>

## Important Considerations

<AccordionGroup>
  <Accordion title="Withdrawal Processing Time" icon="clock">
    After successfully executing a withdrawal, it takes some time for the funds to appear on Arbitrum. The withdrawal must be processed by Hyperliquid's bridge before the USDC becomes available on Arbitrum.
  </Accordion>

<Accordion title="USDC Decimal Format" icon="hashtag">
  USDC uses **6 decimals**. When specifying the withdrawal amount, use the 6-decimal format:

- 5 USDC = `"5000000"`
- 15 USDC = `"15000000"`
- 100 USDC = `"100000000"`

</Accordion>

<Accordion title="Withdrawal Source" icon="wallet">
  Withdrawals are always taken from the Vincent User's **HyperCore perp balance**. If you need to
  withdraw funds from the spot balance, you must first transfer them to the perp balance using the
  [Transfer to Perp](/ability/official-abilities/hyperliquid/transfer-to-perp) action.
</Accordion>

<Accordion title="Destination Address" icon="location-dot">
  If you don't specify a `destination` address, the withdrawal will be sent to the Vincent User's
  Agent Wallet address on Arbitrum. You can optionally specify a different destination address if
  needed.
</Accordion>

  <Accordion title="Verifying Withdrawal Success" icon="check">
    After the withdrawal is initiated, you can verify the perp balance decreased by checking the clearinghouse state using a [Hyperliquid SDK](https://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api), or by using the [Hyperliquid API](https://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api/info-endpoint/perpetuals#retrieve-a-users-perpetuals-account-summary).
  </Accordion>
</AccordionGroup>

## Reference Implementation

For a complete working example showing the full withdrawal workflow including balance verification, see the [withdraw.spec.ts](https://github.com/LIT-Protocol/Vincent/blob/main/packages/apps/ability-hyperliquid/test/e2e/withdraw.spec.ts) end-to-end test in the `ability-hyperliquid` package.

## Next Steps

Explore the rest of the supported Hyperliquid actions:

<CardGroup cols={3}>

<Card title="Deposit" href="/ability/official-abilities/hyperliquid/deposit" icon="arrow-down" />

<Card
  title="Send Spot Asset"
  href="/ability/official-abilities/hyperliquid/send-spot-asset"
  icon="coins"
/>

<Card
  title="Send Perp USDC"
  href="/ability/official-abilities/hyperliquid/send-perp-usdc"
  icon="dollar-sign"
/>

<Card
  title="Transfer to Spot"
  href="/ability/official-abilities/hyperliquid/transfer-to-spot"
  icon="arrow-right"
/>

<Card
  title="Transfer to Perp"
  href="/ability/official-abilities/hyperliquid/transfer-to-perp"
  icon="arrow-left"
/>

<Card
  title="Spot Buy"
  href="/ability/official-abilities/hyperliquid/spot-buy"
  icon="shopping-cart"
/>

<Card title="Spot Sell" href="/ability/official-abilities/hyperliquid/spot-sell" icon="tag" />

<Card
  title="Perp Long"
  href="/ability/official-abilities/hyperliquid/perp-long"
  icon="arrow-up-right"
/>

<Card
  title="Perp Short"
  href="/ability/official-abilities/hyperliquid/perp-short"
  icon="arrow-down-right"
/>

<Card title="Cancel Order" href="/ability/official-abilities/hyperliquid/cancel-order" icon="ban" />

<Card
  title="Cancel All Orders"
  href="/ability/official-abilities/hyperliquid/cancel-all-orders-for-symbol"
  icon="trash"
/>

</CardGroup>
